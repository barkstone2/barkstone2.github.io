---
created: 2025-02-09 13:57
updated: 2025-02-09 14:14
tags:
  - AWS/CloudFront/CachePolicy
---
CloudFront의 캐시 정책은 TTL 설정과, 캐시 키 설정, 압축 설정으로 나뉜다.

![[cloudfront_cache_policy.png|400]]
# TTL 설정
캐싱할 최소 TTL과 최대 TTL, 기본 TTL을 설정할 수 있으며, 해당 설정을 기반으로 엣지에서 캐싱된 파일의 TTL이 결정된다.

최소 TTL과 최대 TTL은 오리진에 설정된 메타 데이터의 TTL이 해당 범위를 벗어나지 않도록 제어하는데 사용된다. 예를 들어 S3에 저장된 파일의 헤더에 max-age=10을 설정했을 때, Min TTL이 20인 경우 엣지에 캐싱된 파일의 TTL은 20이 된다. 최대 TTL의 경우는 반대로 생각하면 된다.

오리진 파일에 특별히 max-age가 설정되어 있지 않은 경우 Default TTL이 사용된다.
# 캐시 키 설정
별도의 설정이 없을 경우 CloudFront는 요청 경로를 캐시 키로 사용한다.
`CloudFront DNS 주소/home.html`을 요청한 경우 해당 경로에 대한 오리진 요청 결과를 해당 요청 경로를 키로 엣지에서 캐싱한다.

이 설정에서는 추가로 캐시 키에 사용할 헤더나 쿠키, 쿼리 파라미터를 지정할 수 있으며, 설정이 존재하는 경우에는 해당 정보들도 포함해 캐시 키로 사용하게 된다.
# 압축 설정
엣지에서 요청 결과를 반환할 때 압축을 사용할 지를 설정할 수 있다.
대부분의 경우 압축하지 않을 이유가 없기 때문에 두 옵션을 모두 활성화하는 것이 좋다.

텍스트 기반의 파일(HTML, CSS, JS 등)을 클라이언트에게 반환할 때 압축된 형태로 반환하게 된다.

대부분의 경우 브라우저에서 요청을 전송할 때 Accept-Encoding 헤더를 통해 수신 가능한 압축 포맷을 전달한다.
크롬 기준으로 gzip, deflate, br(Brotli), zstd가 기본적으로 사용된다.

조건부 요청이 아닌 경우에는 응답 헤더에 `Content-Encoding: br`이 반환되는 것을 확인할 수 있다.
조건부 요청인 경우에는 해당 헤더가 생략된다.

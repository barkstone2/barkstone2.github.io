---
created: 2025-01-01 10:19
updated: 2025-01-01 13:23
tags:
  - Next
---
[[App Router]]는 라우팅과 네비게이션에 하이브리드 접근 방식을 사용한다.
서버에서는 애플리케이션 코드가 라우트 세그먼트에 따라 자동으로 코드 스플릿된다.
동시에 클라이언트에서는 라우트 세그먼트를 프리 페치, 캐시한다.

이는 다시 말해, 유저가 새로운 경로로 이동할 때 브라우저가 전체 페이지를 리로드하지 않고 오직 리렌더링이 발생한 라우트 세그먼트만 리로드한다는 것을 의미한다.
Next.js는 이 방식을 통해 네비게이션 경험과 성능을 향상시키고 있다.

그럼 각각의 최적화 기능에 대해 살펴보자.
# 코드 스플리팅
애플리케이션 코드를 다운로드 가능한 작은 묶음으로 나누는 기능이다.
이를 통해 전송되는 데이터의 양을 줄이고 각 요청의 실행 시간을 줄여 성능 향상을 가져올 수 있다.
서버 컴포넌트를 사용하면 라우트 세그먼트에 따라 자동으로 코드 스플리팅이 적용된다.
다시 말해 현재 경로에서 필요한 코드만 탐색에서 로드됨을 의미한다.
# 프리페칭
프리페칭은 유저가 라우트에 방문하기 전 백그라운드를 통해 라우트를 미리 로드하는 기능이다.
Next.js에서는 두 가지 방법으로 라우트가 프리페치된다.

- `<Link>` 컴포넌트 : 사용자의 뷰포트에 노출되면 자동으로 라우트가 프리페칭된다. 페이지가 처음으로 로드되거나 스크롤을 통해 컴포넌트가 화면에 들어오면 발생한다.
- `router.prefetch()` : `useRouter` 훅을 통해 코드 상에서 라우트를 프리페칭할 수 있다.

`<Link>` 컴포넌트의 기본 프리페치 동작(`prefetch` prop이 정의되지 않거나 null인 경우)은 `loading.js`의 사용 방법에 따라 딸라질 수 있다.
공유되는 레이아웃 영역 중 첫 번째 `loading.js` 파일이 로드되기 전까지의 영역만이 프리페치 되며 30초 동안 캐시된다.
이는 동적 라우트 영역을 모두 페칭하는 비용을 줄이며, 즉시 로딩 상태를 보여줄 수 있으므로 사용자에게 더 나은 시각적 피드백을 제공할 수 있다.

`prefetch` prop을 `false`로 설정하면 프리페칭을 비활성화할 수 있다.
반대로 해당 prop을 `true`로 설정할 경우 전체 데이터 페이지를 프리페치할 수 있다.
# 캐싱
Next.js는 인메모리 클라이언트 사이드 캐시 기능인 [[Router Cache]]를 제공한다.
유저가 앱을 탐색하면, 프리페치된 라우트 세그먼트와 방문한 라우트의 리액트 서버 컴포넌트 페이로드가 이 라우터 캐시에 저장된다.

이는 다시 말해 탐색 과정에서 라우터 캐시가 가능한한 많이 재사용된다는 것을 의미하며, 이를 통해 데이터 전송양과 요청 수를 줄여 성능을 향상시킬 수 있다.
# 부분 렌더링
부분 렌더링은 말 그대로 네비게이션 과정에서 변경된 라우트 세그먼트만을 클라이언트에서 리렌더링 한다는 것을 의미한다. 이때 리렌더링이 불필요한 공유 세그먼트는 기존 상태를 그대로 유지하게 된다.

부분 렌더링을 사용하지 않는다면 각 네비게이션이 전체 페이지의 리렌더링을 발생시킬 것이다.
변경된 세그먼트만을 리렌더링하는 방식은 데이터 전송양과 실행 시간을 감소시키고, 성능 향상을 가져올 수 있다.
# 소프트 네비게이션
브라우저는 페이지 간의 네비게이션이 발생한 경우 하드 네비게이션을 수행한다.
반면 Next.js 앱 라우터는 페이지 간의 네비게이션에 소프트 네비게이션을 지원하며, 이를 통해 변경된 라우트 세그먼트만 리렌더링하는, 부분 렌더링을 보장할 수 있다.
이를 통해 네비게이션 과정에서 클라이언트 리액트 상태가 보존될 수 있다.